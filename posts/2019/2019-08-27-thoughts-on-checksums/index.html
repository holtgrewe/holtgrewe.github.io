<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.92.1">
<title>Thoughts on Checksums &#183; Full Stack Bioinformatics</title>
<meta name=description content>
<meta itemprop=name content="Thoughts on Checksums">
<meta itemprop=description content="It&rsquo;s 2019 and checksums are pervasive everywhere&mldr;
Everywhere?
No, a small community somewhere north in - agh, forget about it!"><meta itemprop=datePublished content="2019-08-27T00:00:00+00:00">
<meta itemprop=dateModified content="2019-08-27T00:00:00+00:00">
<meta itemprop=wordCount content="739"><meta itemprop=image content="https://fullstackbio.de/images/profile.jpg">
<meta itemprop=keywords content>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://fullstackbio.de/images/profile.jpg">
<meta name=twitter:title content="Thoughts on Checksums">
<meta name=twitter:description content="It&rsquo;s 2019 and checksums are pervasive everywhere&mldr;
Everywhere?
No, a small community somewhere north in - agh, forget about it!">
<meta property="og:title" content="Thoughts on Checksums">
<meta property="og:description" content="It&rsquo;s 2019 and checksums are pervasive everywhere&mldr;
Everywhere?
No, a small community somewhere north in - agh, forget about it!">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fullstackbio.de/posts/2019/2019-08-27-thoughts-on-checksums/"><meta property="og:image" content="https://fullstackbio.de/images/profile.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-08-27T00:00:00+00:00">
<meta property="article:modified_time" content="2019-08-27T00:00:00+00:00"><meta property="og:site_name" content="Full Stack Bioinformatics">
<script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://fullstackbio.de/#author","name":null,"image":{"@type":"ImageObject","url":"https://fullstackbio.de/images/profile.jpg"},"description":"From transistors to biomedical insight"},{"@type":"WebSite","@id":"https://fullstackbio.de/#website","url":"https://fullstackbio.de/","name":"Full Stack Bioinformatics","description":"From transistors to biomedical insight","publisher":{"@id":"https://fullstackbio.de/#author"},"inLanguage":"en"},{"@type":"ImageObject","url":"https://fullstackbio.de/images/profile.jpg","caption":"Full Stack Bioinformatics"},{"@type":"WebPage","@id":"https://fullstackbio.de/posts/2019/2019-08-27-thoughts-on-checksums/#webpage","url":"https://fullstackbio.de/posts/2019/2019-08-27-thoughts-on-checksums/","name":"Thoughts on Checksums","isPartOf":{"@id":"https://fullstackbio.de/#website"},"about":{"@id":"https://fullstackbio.de/#author"},"datePublished":"2019-08-27T00:00:00+00:00","dateModified":"2019-08-27T00:00:00+00:00","description":"It\u0026rsquo;s 2019 and checksums are pervasive everywhere\u0026hellip;\nEverywhere?\nNo, a small community somewhere north in - agh, forget about it!","inLanguage":"en","potentialAction":[{"@type":"ReadAction","target":["https://fullstackbio.de/posts/2019/2019-08-27-thoughts-on-checksums/"]}]},{"@type":"Article","isPartOf":{"@id":"https://fullstackbio.de/posts/2019/2019-08-27-thoughts-on-checksums/#webpage"},"mainEntityOfPage":{"@id":"https://fullstackbio.de/posts/2019/2019-08-27-thoughts-on-checksums/#webpage"},"headline":"Thoughts on Checksums","datePublished":"2019-08-27T00:00:00+00:00","dateModified":"2019-08-27T00:00:00+00:00","publisher":{"@id":"https://fullstackbio.de/#author"},"keywords":[],"articleSection":["Opinion"],"inLanguage":"en","author":{"@type":"Person","name":"Manuel Holtgrewe"},"potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://fullstackbio.de/posts/2019/2019-08-27-thoughts-on-checksums/#comments"]}]}]}</script>
<link type=text/css rel=stylesheet href=/css/print.css media=print>
<link type=text/css rel=stylesheet href=/css/poole.css>
<link type=text/css rel=stylesheet href=/css/hyde.css>
<style type=text/css>.sidebar{background-color:#878b94}.read-more-link a{border-color:#878b94}.read-more-link a:hover{background-color:#878b94}.pagination li a{color:#878b94;border:1px solid #878b94}.pagination li.active a{background-color:#878b94}.pagination li a:hover{background-color:#878b94;opacity:.75}footer a,.content a,.related-posts li a:hover{color:#878b94}</style>
<link type=text/css rel=stylesheet href=/css/custom.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin=anonymous>
</head>
<body>
<aside class=sidebar>
<div class=container>
<div class=sidebar-about>
<div class=author-image>
<a href=https://fullstackbio.de/>
<img src=/images/profile.jpg class="img-circle img-headshot center" alt="Profile Picture">
</a>
</div>
<h1>Full Stack Bioinformatics</h1>
<p class=lead>From transistors to biomedical insight</p>
</div>
<nav>
<ul class=sidebar-nav>
<li>
<a href=https://fullstackbio.de/>Home</a>
</li>
<li>
<a href=/about/>About</a>
</li><li>
<a href=/posts/>Posts</a>
</li><li>
<a href=/categories/>Categories</a>
</li><li>
<a href=/tags/>Tags</a>
</li>
</ul>
</nav>
<section class=social-icons>
<a href=https://www.linkedin.com/in/manuel-holtgrewe/ rel=me title=Linkedin target=_blank>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
<a href=https://github.com/holtgrewe rel=me title=GitHub target=_blank>
<i class="fab fa-github" aria-hidden=true></i>
</a>
</section>
</div>
</aside>
<main class="content container">
<div class=post>
<h1 class=title>Thoughts on Checksums</h1>
<div class=post-date>
<time datetime=2019-08-27T00:00:00Z>Aug 27, 2019</time> <span class=readtime>&#183; 4 min read</span>
</div>
<div>
<blockquote>
<p>Give me checksums or give me death.</p>
<p>&ndash; me (ca. 2014)</p>
</blockquote>
<p>It&rsquo;s 2019 and checksums are pervasive everywhere&mldr;
Everywhere?
No, a small community somewhere north in - agh, forget about it!
I&rsquo;m looking at you <em>bioinformatics</em>.</p>
<p>28 years after Ronald Rivest invented <a href=https://en.wikipedia.org/wiki/MD5>MD5</a>, 57 years after <a href=https://en.wikipedia.org/wiki/Cyclic_redundancy_check>CRC32</a>, and 68 years after the &ldquo;invention&rdquo; of the <a href=https://en.wikipedia.org/wiki/Parity_bit>parity bit</a> I&rsquo;m still getting <strong>files without checksums</strong>.</p>
<h2 id=what-is-a-checksum>What is a checksum?</h2>
<p>For those dear readers who live in caves or under rocks (or both as I&rsquo;m occasionally doing), a good example is <a href=https://en.wikipedia.org/wiki/International_Standard_Book_Number>ISBN</a>, you know the number they print on the back of books (<em>books</em> are still universally known, right?).
The wisdom of Wikipedia tells us that if we have a ten-digit ISBN <code>isbn</code> (given as a Python <code>str</code>), then its first digit must be chosen such that</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ae81ff>0</span> <span style=color:#f92672>==</span> sum(i <span style=color:#f92672>*</span> x <span style=color:#66d9ef>for</span> i, digit <span style=color:#f92672>in</span> enumerate(isbn, <span style=color:#ae81ff>1</span>)) <span style=color:#f92672>%</span> <span style=color:#ae81ff>11</span>
</code></pre></div><p>That is, using 1-based counting, the sum of the product of the first to the last digit multiplied by its position <em>modulo</em> 11 must be zero.
Imagine you&rsquo;re on a phone call and need to make the other side write down the ISBN.
The most probable mistakes are that one digit is changed or that two adjacent digits are written down flipped.
And as helpful Wikipedia tells us, it can be proven <em>mathematically</em> that such errors will be detected by checking the condition from above.
That is, the first digit <code>isbn[0]</code> is a <strong>checksum</strong>.</p>
<h2 id=checksum-all-the-things>Checksum all the things!</h2>
<p><img src=/posts/2019/2019-08-27-checksum-all-the-things.jpg alt="CHECKSUM ALL THE THINGS (image)"></p>
<p>There are various uses for checksums but the easiest one is making sure that we have the data that we want without errors (or at least making it highly improbable that we have corrupted data).
<a href=https://en.wikipedia.org/wiki/Digital_signature>Digital signatures</a> are only a fancy kind of checksum.</p>
<p><a href=https://en.wikipedia.org/wiki/Data_degradation>Bit rot</a> is a thing.
Data transmission errors are a thing.
Connections braking up are a thing.</p>
<blockquote>
<p>Listen, you&rsquo;re a nice guy but I don&rsquo;t trust you further than I trust me.
<strong>Pretty please</strong> use checksums next time.</p>
<p>&ndash; me (ca. 2019)</p>
</blockquote>
<p>If I&rsquo;m having a file <code>$file</code> and a checksum file <code>$file.md5</code> then I can verify the file by using the following to check the file.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ pushd <span style=color:#66d9ef>$(</span>dirname $file<span style=color:#66d9ef>)</span>
$ md5sum --check $file.md5</code></pre></div>
<p>Some people will tell you that MD5 is bad and you should really use SHA256.
Fine, just <code>s/md5/sha256/</code>, or <code>s/md5/sha1/</code> if you&rsquo;re retro-data-snobbish.
However, please give me a checksum.
I&rsquo;ve seen corrupted data too often.</p>
<h2 id=computing-checksums-is-slowhard>Computing checksums is slow/hard!</h2>
<p>No, it is not.</p>
<ul>
<li>Consider <a href=http://md5deep.sourceforge.net>hashdeep</a> for computing checksums of directory trees.</li>
<li>Just use the following (or with <code>sha256sum</code>&mldr;) for parallelising checksums.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ parallel -t -j $CORES <span style=color:#e6db74>&#39;pushd {/}; md5sum {.} &gt;{.}.md5&#39;</span> ::: <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    <span style=color:#66d9ef>$(</span>find $path -type f | grep -v <span style=color:#e6db74>&#39;\.md5$&#39;</span><span style=color:#66d9ef>)</span></code></pre></div>
<h2 id=last-resort-built-in-checksums-of-gz-files>Last resort: built-in checksums of <code>.gz</code> files</h2>
<p><strong>Pretty please</strong> give me checksum-ed files.
Using <code>md5sum --check</code> is fast and convenient.</p>
<p>Otherwise, I&rsquo;ll have to fall back to the following.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ gzip --verbose --test $gzfile</code></pre></div>
<p>While it works it is more time-consuming than <code>md5sum --check</code> plus <code>gzip</code> does not like <a href=http://www.htslib.org/doc/tabix.html>bgzip</a> so I&rsquo;ll have to ignore the warnings:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ gzip --verbose --check $bgzfile 2&gt;&amp;<span style=color:#ae81ff>1</span> | grep -v <span style=color:#e6db74>&#39;ignoring&#39;</span></code></pre></div>
<h2 id=one-checksum-file-to-rule-them-all>One checksum file to rule them all?</h2>
<p>All of the <code>*sum</code> tools allow to create one checksum file with on entry each for multiple files.
However, I&rsquo;d argue that in most cases you want one checksum file for each payload file.
For example, if you have a file at <code>$path</code>, you&rsquo;ll want a <code>$path.md5</code>.</p>
<blockquote>
<p>Why?</p>
</blockquote>
<p>The reason is simple.
More often than not you want to transfer a portion of a directory to another location.
This would leave you with the error-prone task of cutting out the section of the multi-file-checksum-file to transfer with the file.
If you have a partner checksum file, just copy <code>$file*</code> and you&rsquo;re done.</p>
<p>Of course there is an exception to every rule.
If you have tens of thousands of files to copy (I&rsquo;m looking at you, Illumina raw output directories) then you don&rsquo;t want to double that file count.
Here, using tools such as <code>hashdeep</code> is highly beneficial in my opinion.</p>
<h2 id=conclusion>Conclusion</h2>
<p>I hope I could convince you that</p>
<ul>
<li>checksums are good,</li>
<li>you should have checksums for everything,</li>
<li>you should send around data around only with checksums,</li>
<li>ideally each file having a partner checksum file.</li>
</ul>
<p><a href=https://xkcd.com/1683/><img src=/posts/2019/2019-08-27-xkcd-1683-data-degradation.png alt="XKCD on data rot"></a></p>
<h2 id=comments>Comments?</h2>
<p>I don&rsquo;t do comments here but <a href=https://www.reddit.com/r/bioinformatics/comments/cwcf1j/thoughts_on_checksums/>posted my blog to reddit</a> where they do.</p>
<h2 id=edits>Edits</h2>
<ul>
<li>I used <code>gzip --check</code> where I should have used <code>gzip --test</code> and now fixed this (thanks to Epistaxis at reddit).</li>
</ul>
</div>
</div>
</main>
<footer>
<div>
<p>
&copy; Manuel Holtgrewe 2022
&#183; <a href=https://creativecommons.org/licenses/by-sa/4.0 target=_blank>CC BY-SA 4.0</a>
&#183; Build with <a href=https://gohugo.io/ target=_blank>Hugo</a> & <a href=https://themes.gohugo.io/soho/ target=_blank>Soho</a> theme
</p>
</div>
</footer>
<script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0=" crossorigin=anonymous></script>
<script src=/js/jquery.min.js></script>
<script src=/js/soho.js></script>
</body>
</html>